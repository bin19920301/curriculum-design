webpackJsonp([13],{JY1k:function(e,t){},W4Gy:function(e,t){},sR4F:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Xxa5"),r=s.n(a),n=s("exGp"),i=s.n(n),o=s("mrNh"),c=s("eOoE"),l={name:"course",components:{talkCmp:s("wNu5").a},data:function(){return{tishi:"保存成功",status:0,loading:!1,id:"",items:"",craftCardInfoDTOList:[],workMessageInfoDTOList:[],totalsi:0,itemsbm:[],itemsxs:[],talktext:"",timer:"",filevalue:"",downurls:"",startId:0,startId2:0,workMessageInfoDTOList2:[],totalsi2:0,teachingid:""}},mounted:function(){this.downurls=c.a;var e=this.$route.params.id;this.id=e,this.Getworkinfobyid(),this.Studentlistmessage(1)},methods:{Addmessagebystudent2:function(e){var t=this;return i()(r.a.mark(function s(){var a,n;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(a=t.teachingid,e){s.next=4;break}return t.$message({showClose:!0,message:"讨论内容不能为空",type:"error"}),s.abrupt("return");case 4:return t.loading=!0,s.prev=6,s.next=9,Object(o.j)(a,e);case 9:0==(n=s.sent).status.code?(t.$message({showClose:!0,message:"发表成功",type:"success"}),t.talktext="",t.Studentlistmessage2(1)):t.$message.error(n.status.description),s.next=16;break;case 13:s.prev=13,s.t0=s.catch(6),console.log(s.t0);case 16:return s.prev=16,t.loading=!1,s.finish(16);case 19:case"end":return s.stop()}},s,t,[[6,13,16,19]])}))()},getmore2:function(e){this.Studentlistmessage2(e)},Studentlistmessage2:function(e){var t=this;return i()(r.a.mark(function s(){var a;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return 10,1==e&&(t.workMessageInfoDTOList2=[],t.startId=0,5),s.prev=3,s.next=6,Object(o._5)(t.items.teaching.id,e,5,t.startId2);case 6:0==(a=s.sent).status.code?(t.totalsi2=a.result.teachingMessageInfoDTOBaseListDTO.total,t.workMessageInfoDTOList2=a.result.teachingMessageInfoDTOBaseListDTO.list.reverse().concat(t.workMessageInfoDTOList2)):t.$message.error(a.status.description),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(3),console.log(s.t0);case 13:return s.prev=13,s.finish(13);case 15:case"end":return s.stop()}},s,t,[[3,10,13,15]])}))()},deletemessage2:function(e){var t=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then(function(){t.Deletestudentmessage2(e.id,e.index)}).catch(function(){})},Deletestudentmessage2:function(e,t){var s=this;return i()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return s.loading=!0,a.prev=1,a.next=4,Object(o._21)(e);case 4:0==(n=a.sent).status.code?(s.$message({showClose:!0,message:"删除成功",type:"success"}),s.workMessageInfoDTOList2.splice(t,1)):s.$message.error(n.status.description),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(1),console.log(a.t0);case 11:return a.prev=11,s.loading=!1,a.finish(11);case 14:case"end":return a.stop()}},a,s,[[1,8,11,14]])}))()},delworkFileDTO:function(e,t){var s=this;this.$confirm("确定要删除作业附件吗？","提示",{type:"warning"}).then(function(){s.Deletewrokfile(e,t)}).catch(function(){})},Deletewrokfile:function(e,t){var s=this;return i()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return s.loading=!0,a.prev=1,a.next=4,Object(o.C)(e);case 4:0==(n=a.sent).status.code?(s.$message({showClose:!0,message:"删除成功",type:"success"}),s.items.workFileDTOList.splice(t,1)):s.$message.error(n.status.description),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(1),console.log(a.t0);case 11:return a.prev=11,s.loading=!1,a.finish(11);case 14:case"end":return a.stop()}},a,s,[[1,8,11,14]])}))()},add_img:function(e){var t=this;return i()(r.a.mark(function s(){var a,n,i,o;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=t.$loading({lock:!0,text:"加载中...",spinner:"el-icon-loading"}),new FileReader,n=e.target.files[0],(i=new FormData).append("file",n,n.name),i.append("workId",t.id),s.prev=6,s.next=9,Object(c.d)("/workfile/addworkfile/",i);case 9:0==(o=s.sent).status.code?(t.pageNum=1,t.$message({message:"上传成功",type:"success"}),t.Getworkinfobyid()):t.$message.error(o.status.description),s.next=16;break;case 13:s.prev=13,s.t0=s.catch(6),console.log(s.t0);case 16:return s.prev=16,a.close(),t.filevalue="",s.finish(16);case 20:case"end":return s.stop()}},s,t,[[6,13,16,20]])}))()},timers:function(){var e=this;this.timer=setInterval(function(){e.savework(2)},1e4)},addafter:function(e){this.craftCardInfoDTOList.splice(e+1,0,{surfaceName:"",processingMethodName:"",processContent:"",id:"",sort:""})},delcarts:function(e){this.craftCardInfoDTOList.splice(e,1)},removefront:function(e){var t=this.craftCardInfoDTOList[e];this.craftCardInfoDTOList.splice(e,1),this.craftCardInfoDTOList.splice(e-1,0,t)},removeafter:function(e){var t=this.craftCardInfoDTOList[e];this.craftCardInfoDTOList.splice(e,1),this.craftCardInfoDTOList.splice(e+1,0,t)},viewwork:function(){this.$router.push({path:"workdetail"})},submitwork:function(){var e=this,t=!1;this.craftCardInfoDTOList.forEach(function(s,a){return s.surfaceName?s.processingMethodName?s.processContent?void 0:(e.$message({showClose:!0,message:"请为工序"+parseInt(a+1)+"填写工序内容",type:"warning"}),void(t=!0)):(e.$message({showClose:!0,message:"请为工序"+parseInt(a+1)+"填写加工形式",type:"warning"}),void(t=!0)):(e.$message({showClose:!0,message:"请为工序"+parseInt(a+1)+"填写加工表面",type:"warning"}),void(t=!0))}),t||this.$confirm("确定提交？提交完成不能修改","提示",{type:"warning"}).then(function(){e.savework(1)}).catch(function(){})},deletemessage:function(e){var t=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then(function(){t.Deletestudentmessage(e.id,e.index)}).catch(function(){})},Deletestudentmessage:function(e,t){var s=this;return i()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return s.loading=!0,a.prev=1,a.next=4,Object(o.y)(e);case 4:0==(n=a.sent).status.code?(s.$message({showClose:!0,message:"删除成功",type:"success"}),s.workMessageInfoDTOList.splice(t,1)):s.$message.error(n.status.description),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(1),console.log(a.t0);case 11:return a.prev=11,s.loading=!1,a.finish(11);case 14:case"end":return a.stop()}},a,s,[[1,8,11,14]])}))()},Submits:function(){var e=this;return i()(r.a.mark(function t(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(o._8)(e.id);case 4:0==(s=t.sent).status.code?(e.$message({showClose:!0,message:"作业提交成功",type:"success"}),e.Getworkinfobyid()):e.$message.error(s.status.description),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.log(t.t0);case 11:return t.prev=11,e.loading=!1,t.finish(11);case 14:case"end":return t.stop()}},t,e,[[1,8,11,14]])}))()},savework:function(e){var t=this;return i()(r.a.mark(function s(){var a,n,i;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=t.craftCardInfoDTOList.map(function(e,t){return{craftCardId:e.id,surface:e.surfaceName,processingMethod:e.processingMethodName,processContent:e.processContent,sort:t}}),2!=e?t.loading=!0:t.tishi="正在自动保存...",n=t,s.prev=3,s.next=6,Object(o.d)(t.id,a);case 6:0==(i=s.sent).status.code?1==e?t.Submits():0==e?t.$message({showClose:!0,message:"作业保存成功",type:"success"}):setTimeout(function(){n.tishi="保存成功"},1500):t.$message.error(i.status.description),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(3),console.log(s.t0);case 13:return s.prev=13,t.loading=!1,s.finish(13);case 16:case"end":return s.stop()}},s,t,[[3,10,13,16]])}))()},Getworkinfobyid:function(){var e=this;return i()(r.a.mark(function t(){var s,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,s=e.id,t.prev=2,t.next=5,Object(o.M)(s);case 5:0==(a=t.sent).status.code?(e.items=a.result,e.teachingid=a.result.teaching.id,e.Studentlistmessage2(1),e.status=a.result.status,0!=a.result.status&&2!=a.result.status||e.timers(),0==a.result.craftCardInfoDTOList.length?e.craftCardInfoDTOList=[{surfaceName:"",processingMethodName:"",processContent:"",id:"",sort:""}]:e.craftCardInfoDTOList=e.$sortBykey(a.result.craftCardInfoDTOList,"sort")):e.$message.error(a.status.description),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.log(t.t0);case 12:return t.prev=12,e.loading=!1,t.finish(12);case 15:case"end":return t.stop()}},t,e,[[2,9,12,15]])}))()},Addmessagebystudent:function(e){var t=this;return i()(r.a.mark(function s(){var a,n;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(a=t.id,e){s.next=4;break}return t.$message({showClose:!0,message:"讨论内容不能为空",type:"error"}),s.abrupt("return");case 4:return t.loading=!0,s.prev=6,s.next=9,Object(o.g)(a,e);case 9:0==(n=s.sent).status.code?(t.$message({showClose:!0,message:"发表成功",type:"success"}),t.talktext="",t.Studentlistmessage(1)):t.$message.error(n.status.description),s.next=16;break;case 13:s.prev=13,s.t0=s.catch(6),console.log(s.t0);case 16:return s.prev=16,t.loading=!1,s.finish(16);case 19:case"end":return s.stop()}},s,t,[[6,13,16,19]])}))()},getmore:function(e){this.Studentlistmessage(e)},Studentlistmessage:function(e){var t=this;return i()(r.a.mark(function s(){var a;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return 10,1==e&&(t.workMessageInfoDTOList=[],t.startId=0,5),s.prev=3,s.next=6,Object(o._6)(t.id,e,5,t.startId);case 6:0==(a=s.sent).status.code?(t.totalsi=a.result.total,t.workMessageInfoDTOList=a.result.list.reverse().concat(t.workMessageInfoDTOList)):t.$message.error(a.status.description),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(3),console.log(s.t0);case 13:return s.prev=13,s.finish(13);case 15:case"end":return s.stop()}},s,t,[[3,10,13,15]])}))()}}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tstuwork"},[s("div",{staticClass:"crumbs"},[s("el-breadcrumb",{attrs:{separator:"/"}},[s("el-breadcrumb-item",[s("i",{staticClass:"el-icon-c-scale-to-original"}),e._v(" 课程设计\n            ")]),e._v(" "),e.items?s("el-breadcrumb-item",[e._v(e._s(e.items.teaching.name))]):e._e()],1)],1),e._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"container"},[s("div",{staticClass:"form"},[e.items?s("h3",[e._v(e._s(e.items.teaching.name))]):e._e(),e._v(" "),e.items?s("el-form",{ref:"form",attrs:{"label-width":"90px"}},[s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"指导老师："}},[e._v("\n                    "+e._s(e.items.teaching.teacherName)+"\n                ")]),e._v(" "),s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"学生："}},[e._v("\n                    "+e._s(e.items.studentName)+"\n                ")]),e._v(" "),s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"作业项目："}},[e._v("\n                    "+e._s(e.items.workProjectInfoDTO.name)+"\n                ")]),e._v(" "),s("el-form-item",{attrs:{label:"项目简介："}},[s("div",{staticClass:"teacherishi"},[e._v(e._s(e.items.workProjectInfoDTO.desc))])]),e._v(" "),s("el-form-item",{attrs:{label:"相关资料："}},[e._l(e.items.workProjectInfoDTO.filelist,function(t){return[s("a",{staticClass:"download-bg",attrs:{target:"_blank",href:e.downurls+t.url}},[s("el-button",{staticClass:"download",attrs:{type:"text"}},[e._v(e._s(t.name))]),e._v(" "),s("i",{staticClass:"el-icon-download"})],1),s("br")]})],2),e._v(" "),s("el-form-item",{attrs:{label:"工艺卡片："}},[e._l(e.craftCardInfoDTOList,function(t,a){return 1==e.status||3==e.status?s("el-form",{key:a,ref:"form",refInFor:!0,staticClass:"form-in",attrs:{"label-width":"85px"}},[s("h4",[e._v("工序"+e._s(t.sort+1))]),e._v(" "),s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"加工表面："}},[e._v("\n                          "+e._s(t.surfaceName)+"\n                      ")]),e._v(" "),s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"加工形式："}},[e._v("\n                          "+e._s(t.processingMethodName)+"\n                      ")]),e._v(" "),s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"工序内容："}},[s("div",{staticClass:"teacherishi"},[e._v(e._s(t.processContent))])])],1):e._e()}),e._v(" "),e._l(e.craftCardInfoDTOList,function(t,a){return 0==e.status||2==e.status?s("el-form",{key:a,ref:"form",refInFor:!0,staticClass:"form-in",attrs:{"label-width":"85px"}},[s("h4",[e._v("工序"+e._s(a+1)+"   "),s("el-button",{staticClass:"del-button",attrs:{disabled:e.craftCardInfoDTOList.length<2,size:"mini",type:"danger",plain:""},on:{click:function(t){return e.delcarts(a)}}},[e._v("删除卡片")])],1),e._v(" "),s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"加工表面："}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.surfaceName,expression:"item.surfaceName"}],attrs:{type:"text",placeholder:"请输入加工表面"},domProps:{value:t.surfaceName},on:{input:function(s){s.target.composing||e.$set(t,"surfaceName",s.target.value)}}})]),e._v(" "),s("el-form-item",{staticClass:"work-date",attrs:{size:"small",label:"加工形式："}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.processingMethodName,expression:"item.processingMethodName"}],attrs:{type:"text",placeholder:"请输入加工形式"},domProps:{value:t.processingMethodName},on:{input:function(s){s.target.composing||e.$set(t,"processingMethodName",s.target.value)}}})]),e._v(" "),s("el-form-item",{staticClass:"work-date work-date-cont",attrs:{size:"small",label:"工序内容："}},[s("div",{staticClass:"modify-bg"},[s("div",{staticClass:"modify-top"},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"300",autosize:{minRows:3},"show-word-limit":""},model:{value:t.processContent,callback:function(s){e.$set(t,"processContent",s)},expression:"item.processContent"}})],1),e._v(" "),s("div",{staticClass:"modify"},[s("p",[s("el-button",{attrs:{type:"primary",disabled:0==a,size:"mini",plain:""},on:{click:function(t){return e.removefront(a)}}},[e._v(" 向前移动 ")])],1),e._v(" "),s("p",[s("el-button",{attrs:{disabled:a+1==e.craftCardInfoDTOList.length,type:"primary",size:"mini",plain:""},on:{click:function(t){return e.removeafter(a)}}},[e._v(" 向后移动 ")])],1),e._v(" "),s("p",[s("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.addafter(a)}}},[e._v(" 后方插入 ")])],1)])])])],1):e._e()})],2),e._v(" "),s("el-form-item",{attrs:{label:"作业附件："}},[e._l(e.items.workFileDTOList,function(t,a){return[s("a",{staticClass:"download-bg",attrs:{target:"_blank",href:e.downurls+t.url}},[s("el-button",{staticClass:"download",attrs:{type:"text"}},[e._v(e._s(t.name))])],1),0==e.status||2==e.status?s("i",{staticClass:"el-icon-delete",staticStyle:{"margin-left":"20px",color:"red",cursor:"pointer"},on:{click:function(s){return e.delworkFileDTO(t.id,a)}}}):e._e(),s("br")]}),e._v(" "),0==e.status||2==e.status?s("a",{staticClass:"file"},[e._v("上传附件"),s("input",{staticClass:"upload",attrs:{type:"file"},domProps:{value:e.filevalue},on:{change:e.add_img}})]):e._e()],2),e._v(" "),s("el-form-item",{attrs:{label:"作业讨论："}},[s("el-tabs",{attrs:{type:"border-card"}},[s("el-tab-pane",{attrs:{label:"私信老师"}},[s("talkCmp",{attrs:{workMessageInfoDTOList:e.workMessageInfoDTOList,total:e.totalsi},on:{getmore:e.getmore,pus:e.Addmessagebystudent,dele:e.deletemessage}})],1),e._v(" "),s("el-tab-pane",{attrs:{label:"公共讨论区"}},[s("talkCmp",{attrs:{workMessageInfoDTOList:e.workMessageInfoDTOList2,total:e.totalsi2},on:{getmore:e.getmore2,pus:e.Addmessagebystudent2,dele:e.deletemessage2}})],1)],1)],1)],1):e._e()],1)]),e._v(" "),e.items?s("div",{staticClass:"savebg"},[s("div",{staticClass:"savein"},[0==e.status||2==e.status?[s("p",{staticClass:"fl"},[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.savework(0)}}},[e._v("保存")]),e._v(" "+e._s(e.tishi))],1),e._v(" "),s("p",{staticClass:"fr"},[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.submitwork}},[e._v("保存并提交")]),e._v(" 请于"+e._s(e.items.teaching.deadlineTime)+" 之前提交作业")],1)]:e._e(),e._v(" "),1==e.status?[s("p",{staticClass:"fr"},[s("el-alert",{attrs:{title:"作业已提交",closable:!1,effect:"dark",type:"success"}})],1)]:e._e(),e._v(" "),3==e.status?[s("p",{staticClass:"fr"},[s("el-alert",{attrs:{title:"作业已完成",closable:!1,effect:"dark",type:"success"}})],1)]:e._e()],2)]):e._e()])},staticRenderFns:[]};var d=s("VU/8")(l,u,!1,function(e){s("W4Gy"),s("JY1k")},"data-v-23deb9dc",null);t.default=d.exports}});
//# sourceMappingURL=13.d9b7793ef43c996beae4.js.map